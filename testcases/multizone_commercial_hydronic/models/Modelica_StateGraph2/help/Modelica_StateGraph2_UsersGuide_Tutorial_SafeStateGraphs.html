<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs</title>
<meta name="HTML-Generator" content="Dymola">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="&quot;Safe StateGraphs&quot;">
<style type="text/css">
*       { font-size: 100%; font-family: Arial, sans-serif; }
.modelica, .modelica * { font-size: 90%; font-family: Courier, monospace; white-space: pre; } /* For the Modelica code (in exported html). */
h4      { font-size: 100%; font-weight: bold; color: green; } 
h3      { font-size: 110%; font-weight: bold; color: green; }
h2      { font-size: 130%; font-weight: bold; color: green; }
address { font-weight: normal; }
td      { padding: 2px; border: 1px solid #808080; vertical-align: top; }
th      { padding: 2px; border: 1px solid #808080; vertical-align: top; font-weight: bold; }
table   { border: 1px solid #808080; border-collapse: collapse; }
pre, code {font-family: "Courier New", monospace;}
pre {white-space: pre; overflow-x : hidden;}
.ModelicaDescription {font-weight: bold;} /* For the description string of the class. */
.ModelicaBaseClass {} /* For the list of base-classes at the of the description. */
.ModelicaKeyword { color: blue; font-weight: normal; font-style: normal; } /* Keywords in Modelica. */
.ModelicaComment { color: #006400;  font-weight: normal; font-style: normal;} /* All three variants of comments in Modelica.  */
.ModelicaString { color: #006400;  font-weight: normal; font-style: normal;} /* String constants. */
.ModelicaClass { color: red; font-weight: normal; font-style: normal;} /* Formatting the names of referenced classes (for base-class and components). */
.ModelicaFunction { color: red; font-weight: normal; font-style: normal;} /* Formatting for called functions. */
.ModelicaTablePackageContent { } /* The table of contents for each package. */
.ModelicaTableCrossReference { } /* The optional cross-reference table. */
.ModelicaTableInputs {} /* The table of inputs for a function. */
.ModelicaTableOutputs {} /* The table of outputs for a function. */
.ModelicaTableParameters {} /* The table of parameters for a model/block. */
.ModelicaTableConnectors {} /* The table of connectors for a model/block. */
.ModelicaTableContents {} /* The table of contents for a connector. */
.ModelicaStartAttribute { font-weight: bold; } /* The formatting used for start-attribute in the table of parameters, to separate them from parameter values. */
.ModelicaParameterTab { background-color: #c0c0c0; font-weight: bold; } /* The tab-heading in the table of parameters */
.ModelicaParameterGroup { background-color: #e0e0e0; } /* The group-heading in the table of parameters */
</style>
</head>
<body>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE SafeStateGraphs<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Modelica_StateGraph2.UsersGuideI.png" alt="Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs" align="right" style="border: 1px solid" width="80" height="80">
<a name="Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs"></a><a href="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial"
>Modelica_StateGraph2.UsersGuide.Tutorial</a>.SafeStateGraphs</h2>
<p>
</p>

<p>
In this section it will be discussed in which sense &quot;StateGraph2&quot; models
are &quot;safe&quot;. This section consists of the following sub-sections:
</p>

<ol>
<li>&quot;<a href="Modelica_StateGraph2_UsersGuide_Tutorial_SafeStateGraphs.html#Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.ValidGraphStructures"
>Valid
    Graph Structures</a>&quot; discusses that only valid graph structures of a
    StateGraph2 model will be accepted by a Modelica tool.</li>

<li>&quot;<a href="Modelica_StateGraph2_UsersGuide_Tutorial_SafeStateGraphs.html#Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.SingleAssignmentRule"
>Single
    Assignment Rule</a>&quot; discusses that a variable must always be defined by exactly
    one equation and therefore non-determinism as in other state machine formalisms cannot
    occur (especially, it is not possible to assign the same variable twice in parallel
    executing branches).</li>

<li>&quot;<a href="Modelica_StateGraph2_UsersGuide_Tutorial_SafeStateGraphs.html#Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.BoundedEventIterations"
>Bounded
    Event Iterations</a>&quot; discusses that infinite event looping is not possible,
    because it is required that every &quot;loop&quot; in a StateGraph2 model must have at
    least one delayed Transition.</li>

</ol>

<pre>
</pre>
<h3>Package Content</h3>
<table summary="Package Content" class="ModelicaTablePackageContent">
<tr>
<th>Name</th>
<th>Description</th>
</tr>
<tr>
<td><img src="Modelica_StateGraph2.UsersGuide.TutorialS.png" alt="Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.ValidGraphStructures" width="20" height="20" align="top">&nbsp;<a href="Modelica_StateGraph2_UsersGuide_Tutorial_SafeStateGraphs.html#Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.ValidGraphStructures"
>ValidGraphStructures</a>
</td>
<td>Valid Graph Structures</td>
</tr>
<tr>
<td><img src="Modelica_StateGraph2.UsersGuide.TutorialS.png" alt="Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.SingleAssignmentRule" width="20" height="20" align="top">&nbsp;<a href="Modelica_StateGraph2_UsersGuide_Tutorial_SafeStateGraphs.html#Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.SingleAssignmentRule"
>SingleAssignmentRule</a>
</td>
<td>Single Assignment Rule</td>
</tr>
<tr>
<td><img src="Modelica_StateGraph2.UsersGuide.TutorialS.png" alt="Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.BoundedEventIterations" width="20" height="20" align="top">&nbsp;<a href="Modelica_StateGraph2_UsersGuide_Tutorial_SafeStateGraphs.html#Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.BoundedEventIterations"
>BoundedEventIterations</a>
</td>
<td>Bounded Event Iterations</td>
</tr>
</table>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE ValidGraphStructures<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Modelica_StateGraph2.UsersGuideI.png" alt="Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.ValidGraphStructures" align="right" style="border: 1px solid" width="80" height="80">
<a name="Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.ValidGraphStructures"></a><a href="Modelica_StateGraph2_UsersGuide_Tutorial_SafeStateGraphs.html#Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs"
>Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs</a>.ValidGraphStructures</h2>

<p>
Contrary to
<a href="../../Modelica 3.2.3/help/Modelica_StateGraph.html#Modelica.StateGraph"
>Modelica.StateGraph</a>
(version 1 of the library which is distributed with the Modelica Standard Library since 2004), only <u>valid graph structures</u> are accepted for the Modelica_StateGraph2 library. Wrong graph structures result in translation errors of the model.
</p>

<p>
For example, the model of the next Figure gives a translation error, because it has two initial steps:
</p>

<blockquote>
<img src="../Resources/Images/StateGraph/UsersGuide/WrongInitialSteps.png">
</blockquote>

<p>
Also, the model of the next Figure gives a translation error, because a branch
of the Parallel component branches wrongly out of the component.
</p>

<blockquote>
<img src="../Resources/Images/StateGraph/UsersGuide/WrongParallel.png">
</blockquote>

<p>
More examples of wrong StateGraph2 models that result in translation errors
are available
<a href="Modelica_StateGraph2_Examples_WrongStateGraphs.html#Modelica_StateGraph2.Examples.WrongStateGraphs"
>here</a>.
</p>
<pre>
</pre>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE SingleAssignmentRule<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Modelica_StateGraph2.UsersGuideI.png" alt="Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.SingleAssignmentRule" align="right" style="border: 1px solid" width="80" height="80">
<a name="Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.SingleAssignmentRule"></a><a href="Modelica_StateGraph2_UsersGuide_Tutorial_SafeStateGraphs.html#Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs"
>Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs</a>.SingleAssignmentRule</h2>

<p>
In all state machine formalisms problems are present when assignments to the same variables are performed in branches that are executed in parallel.
Typically, <b>actions</b> are formulated <b>within a step</b>. Such actions are, e.g.,
distinguished as <b>entry</b>, <b>normal</b>, <b>exit</b> and
<b>abort</b> actions. For example, a valve might be opened by
an entry action of a step and might be closed by an exit
action of the same step. This widly used standard approach
becomes critical, when the same variable is assigned in graphs
that are executed in parallel, because it is then not clear which
value the variable will have, and different tools might give different
results.
</p>

<p>
In StateGraphs, it is <b>not possible</b> to assign the same variable in graphs that
are executed in parallel, due to Modelicas "<u>single assignment rule</u>" that requires that every
variable is defined by exactly one equation.
This feature of a StateGraph2 is <b>very useful</b>, since it allows
a Modelica translator to <b>guarantee</b> that a given StateGraph2
has always <b>deterministic</b> behaviour without conflicts.
In other state diagram methodologies this is much more cumbersome. For example,
if two steps are executed in parallel and both step actions
modify the same variable, the result is either non-deterministic
or non-obvious rules have to be defined which action
takes priority. In a StateGraph2, such a situation is detected by
the translator resulting in an error, since there are two equations
to compute one variable.
</p>

<p>
In the Figure below an artifical example is shown how to handle such
problems in a StateGraph2 model, e.g., with a
<a href="Modelica_StateGraph2_Blocks_MathBoolean.html#Modelica_StateGraph2.Blocks.MathBoolean.MultiSwitch"
>MultiSwitch</a>
action block &quot;openValve&quot;. The purpose is to set:
</p>

<pre>
  openValve.y = <b>true</b>,  <b>if</b> Step fill1 is entered
  openValve.y = <b>false</b>, <b>if</b> Step fill2 is entered
</pre>

<p>
and the question is which value openValve.y will have, if both steps fill1 and fill2 are executed in parallel. In the StateGraph2 model below, everything is well defined: There are two input connections to the openValve block. If both become true at the same time instant, the connection with the &quot;lowest&quot; index (i.e., the upper signal in the Figure) has highest priority (as defined and implemented in the MultiSwitch block). Therefore, openValve.y gets the value <b>true</b>, once the Parallel component is entered.
</p>

<blockquote>
<img src="../Resources/Images/StateGraph/UsersGuide/ActionsWithPriority.png">
</blockquote>


<pre>
</pre>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE BoundedEventIterations<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Modelica_StateGraph2.UsersGuideI.png" alt="Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.BoundedEventIterations" align="right" style="border: 1px solid" width="80" height="80">
<a name="Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs.BoundedEventIterations"></a><a href="Modelica_StateGraph2_UsersGuide_Tutorial_SafeStateGraphs.html#Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs"
>Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs</a>.BoundedEventIterations</h2>

<p>
<img src="../Resources/Images/StateGraph/UsersGuide/WrongInfiniteLooping.png" align="right">
At an event instant, an iteration occurs, due to the Modelica semantics (= whenever a new event occurs, the model is re-evaluated). This means that Transitions keep firing along a connected graph, as long as the firing conditions are true. The question therefore arises, whether infinite event looping is possible? A simple example of this kind is shown in the Figure to the right.
Here, all Transition conditions are true and therefore all Transitions fire forever. This is no valid StateGraph model and will result in a translation error.
</p>

<p>
In order to avoid a situation as in the Figure to the right, it is required that a StateGraph2 model has at least one delayed Transition per loop. This means that one of T1, T2, or T3, must be a delayed Transition, otherwise a translation error occurs. Since event iteration stops at a delayed Transition, infinite event looping cannot occur. This also means that at one time instant every Transition can fire at most once and therefore the number of model evaluations at an event instant is bounded by the number of Transition components.
</p>

<p>
It is still possible that infinite event looping occurs due to model errors in other parts of the model. For example, if a user introduces an equation of the form &quot;J = <b>pre</b>(J) + 1&quot; outside of a when-clause, event iteration does not stop. Although this situation is not completely satisfactory, it helps already a lot if a tool points out potential problems of a StateGraph2 model, in case delayed transitions are missing.
</p>

<pre>
</pre>
<address>
<a href="http://www.3ds.com/">Automatically generated</a> Mon Apr  1 15:05:49 2019.
</address>
</body>
</html>
